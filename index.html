<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#001E38">
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" type="image/png" href="https://i.ibb.co/kgjTkMDX/Gemini-Generated-Image-ky6p34ky6p34ky6p-Photoroom.png">
    
    <title>BZN12 Studio V109 FINAL</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Barlow+Condensed:wght@600;800&family=Bebas+Neue&family=Chakra+Petch:wght@700&family=Do+Hyeon&family=Exo+2:wght@700&family=Fjalla+One&family=Kanit:wght@700&family=Oswald:wght@500;700&family=Passion+One:wght@700&family=Righteous&family=Roboto+Condensed:wght@300;400;700&family=Russo+One&family=Saira+Extra+Condensed:wght@700&family=Teko:wght@400;600&family=Titillium+Web:wght@700&family=Montserrat:wght@800&family=Playfair+Display:wght@700&family=Lobster&family=Orbitron:wght@700&family=Bangers&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>

    <style>
        :root { 
            --azul: #001E38; --oro: #F2C317; 
            /* Variables din√°micas para el glow f√≠sico */
            --glow-opacity: 0.8;
            --glow-blur: 8px;
        }
        html, body { margin: 0; padding: 0; font-family: 'Roboto Condensed', sans-serif; background: #001222; color: white; min-height: 100vh; padding-bottom: env(safe-area-inset-bottom); }
        ::-webkit-scrollbar { display: none; }

        .navbar { background: rgba(0, 30, 56, 0.95); backdrop-filter: blur(10px); padding: 15px; text-align: center; border-bottom: 2px solid var(--oro); position: sticky; top: 0; z-index: 1000; font-family: 'Anton'; font-size: 24px; letter-spacing: 1px; user-select: none; }
        .main-wrapper { max-width: 600px; margin: 0 auto; padding-bottom: 80px; }
        .preview-section { padding: 20px; display: flex; justify-content: center; background: radial-gradient(circle, #1a3b5c 0%, #000 100%); }
        
        #banner-container { transform-origin: top center; box-shadow: 0 20px 50px rgba(0,0,0,0.6); transition: 0.3s; position: relative; }
        
        /* LIENZO BASE */
        .lienzo { width: 400px; height: 500px; position: relative; overflow: hidden; background: #000; border: 1px solid #333; }
        
        .fondo-img { position: absolute; width: 100%; height: 100%; background-size: cover; background-position: center; z-index: 1; }
        .fondo-sombra { position: absolute; width: 100%; height: 100%; background: radial-gradient(circle at top right, transparent 40%, rgba(0,0,0,0.9) 100%); z-index: 2; }
        .overlay-dim { position: absolute; width: 100%; height: 100%; background: black; opacity: 0; z-index: 1; pointer-events: none; }

        /* === SISTEMA DE CAPAS F√çSICAS === */
        
        /* Contenedor para mover al jugador y su brillo juntos */
        #player-wrapper {
            position: absolute; bottom: 0; right: -50px; width: 300px; height: 75%; z-index: 3;
            transform-origin: bottom center; pointer-events: none;
        }

        /* 1. CAPA GLOW F√çSICA (Atr√°s) */
        .player-glow {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; z-index: 1;
            /* Se establece por defecto, pero JS forzar√° inline para la exportaci√≥n */
            filter: sepia(100%) hue-rotate(5deg) saturate(1000%) brightness(1.2) blur(var(--glow-blur)); 
            opacity: var(--glow-opacity);
            transform: scale(1.05); /* Un poco m√°s grande para que sobresalga */
            transition: opacity 0.2s, filter 0.2s;
            display: none; /* Se activa con JS */
        }

        /* 2. CAPA PRINCIPAL F√çSICA (Adelante) */
        .player-main {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; z-index: 2;
        }

        /* 3. CAPA FADE F√çSICA (Div s√≥lido en la base del lienzo) */
        .player-fade-layer {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 25%; z-index: 4;
            background: linear-gradient(to top, #000000 15%, transparent 100%);
            display: none; /* Se activa con JS */
            pointer-events: none;
        }

        /* RESTO DEL DISE√ëO */
        .legal { position: absolute; bottom: 10px; width: 100%; text-align: center; font-size: 10px; color: #aaa; z-index: 20; text-shadow: 1px 1px 2px black; }
        
        .bloque-header-11 { position: absolute; top:0; left:0; width:100%; height:100%; pointer-events: none; }
        .logo-bzn { position: absolute; top: 20px; left: 20px; width: 50px; height: 50px; border-radius: 50%; background: var(--azul); border: 2px solid var(--oro); display: flex; align-items: center; justify-content: center; z-index: 20; }
        .logo-bzn img, .escudo-mini, .logo-noticia img { width: 100%; height: 100%; object-fit: contain; }
        
        .titulo-formacion { position: absolute; top: 20px; left: 95px; z-index: 10; font-family: 'Teko'; font-weight: 600; font-size: 72px; color: white; letter-spacing: -1px; line-height: 0.8; text-shadow: 2px 2px 4px rgba(0,0,0,0.9); }
        .info-partido { position: absolute; top: 85px; left: 100px; z-index: 10; font-size: 16px; color: #ddd; font-family: 'Teko'; letter-spacing: 0.5px; text-shadow: 1px 1px 3px rgba(0,0,0,0.9); }
        .escudos-container { position: absolute; top: 25px; right: 20px; display: flex; gap: 5px; z-index: 50; }
        .escudo-mini { width: 45px; height: 45px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8)); }
        
        .lista-jugadores { position: absolute; z-index: 5; top: 120px; left: 20px; display: flex; flex-direction: column; text-shadow: 1px 1px 3px black; }
        .fila-jugador { display: flex; align-items: center; line-height: 1.1; }
        .dorsal { font-family: 'Oswald'; font-weight: 700; color: var(--oro); width: 35px; text-align: right; margin-right: 12px; font-size: 1.1em; }
        .nombre-completo { text-transform: uppercase; letter-spacing: 0.5px; }
        .nombre-pila { font-family: 'Roboto Condensed'; font-weight: 300; color: rgba(255,255,255,0.7); margin-right: 6px; font-size: 1em; }
        .apellido { font-family: 'Roboto Condensed'; font-weight: 700; color: white; font-size: 1em; }
        
        .dt-info { position: absolute; bottom: 60px; left: 20px; z-index: 5; font-family: 'Teko'; font-size: 24px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 5px; width: 150px; text-shadow: 1px 1px 2px black; }
        .dt-label { color: var(--oro); font-weight: 700; margin-right: 10px; }

        .modo-noticia .bloque-header-11, .modo-noticia .lista-jugadores, .modo-noticia .dt-info { display: none; }
        .modo-noticia #player-wrapper { height: 85%; bottom: -30px; left: 50%; transform: translateX(-50%); right: auto; }
        
        .logo-noticia { position: absolute; top: 30px; left: 30px; width: 50px; height: 50px; border-radius: 50%; background: var(--azul); border: 2px solid var(--oro); display: flex; align-items: center; justify-content: center; z-index: 20; }
        .bloque-noticia { position: absolute; z-index: 10; width: 100%; text-align: center; padding: 0 20px; bottom: 80px; box-sizing: border-box; }
        .modo-noticia h2 { font-family: 'Teko'; font-weight: 600; font-size: 42px; margin: 0; text-shadow: 2px 2px 4px black; }
        .modo-noticia h1 { font-family: 'Teko'; font-weight: 600; font-size: 64px; color: var(--oro); line-height: 0.9; margin: 5px 0 10px 0; text-shadow: 3px 3px 6px black; }
        .modo-noticia p { font-family: 'Teko'; font-weight: 400; font-size: 24px; color: #ddd; margin: 0; text-shadow: 1px 1px 3px black; }
        
        .modo-11 .logo-noticia, .modo-11 .bloque-noticia { display: none; }
        .oculto { display: none !important; }

        /* UI CONTROLES */
        .controls-section { padding: 15px; }
        .tabs-menu { display: flex; overflow-x: auto; gap: 8px; padding-bottom: 12px; margin-bottom: 5px; }
        .tab-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: #888; padding: 10px 16px; border-radius: 8px; font-family: 'Oswald'; font-size: 14px; white-space: nowrap; transition: 0.2s; cursor: pointer; }
        .tab-btn.active { background: var(--oro); color: var(--azul); border-color: var(--oro); font-weight: bold; transform: scale(1.05); }
        .tab-panel { display: none; background: var(--glass); border: 1px solid var(--border); border-radius: 12px; padding: 20px; animation: fadeIn 0.3s ease; }
        .tab-panel.active { display: block; }
        .glass-card-inner { background: rgba(0,0,0,0.2); border-radius: 8px; padding: 15px; border: 1px solid var(--border); margin-top: 15px; }
        label { color: var(--oro); font-weight: bold; font-size: 11px; display: block; margin-bottom: 6px; font-family: 'Oswald'; text-transform: uppercase; letter-spacing: 0.5px; }
        input, select, textarea { width: 100%; padding: 12px; background: rgba(0,0,0,0.5); border: 1px solid #444; color: white; border-radius: 8px; font-size: 16px; box-sizing: border-box; margin-bottom: 12px; outline: none; font-family: 'Roboto Condensed'; }
        .pill-selector { display: flex; background: rgba(0,0,0,0.4); padding: 4px; border-radius: 8px; margin-bottom: 15px; }
        .pill { flex: 1; text-align: center; cursor: pointer; margin: 0; }
        .pill input { display: none; }
        .pill span { display: block; padding: 8px; border-radius: 6px; font-size: 12px; color: #aaa; transition: 0.3s; }
        .pill input:checked + span { background: var(--oro); color: #000; font-weight: bold; }
        .upload-btn-wrapper { position: relative; overflow: hidden; margin-bottom: 10px; }
        .btn-ghost { border: 1px dashed #666; color: #ccc; background: transparent; width: 100%; padding: 12px; border-radius: 8px; margin-top: 5px; cursor: pointer; }
        .upload-btn-wrapper input[type=file] { font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer; }
        .slider-box { background: rgba(0, 0, 0, 0.3); padding: 10px; border-radius: 8px; border: 1px solid #333; margin-top: 10px; }
        .range-row { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        input[type=range] { width: 100%; margin: 0; accent-color: var(--oro); }
        .btn-small { background: #333; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer; width: 100%; margin-top: 5px; }
        
        .formato-story { width: 360px !important; height: 640px !important; }
        .formato-square { width: 400px !important; height: 400px !important; }

        .btn-descarga-flotante { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; border-radius: 50%; background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3); color: white; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.5); z-index: 9999; cursor: pointer; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(8px); }
        .modal-content { background: #1a1a1a; padding: 25px; border-radius: 16px; text-align: center; width: 90%; max-height: 90vh; border: 1px solid var(--oro); overflow-y: auto; }
        .modal-content img { max-width: 100%; border-radius: 8px; display: block; margin: 0 auto; box-shadow: 0 0 20px rgba(0,0,0,0.5); pointer-events: auto !important; -webkit-user-drag: none; -webkit-touch-callout: default !important; user-select: none; }
        .btn-download-success { background: var(--verde); color: white; border: none; padding: 15px; border-radius: 8px; font-size: 16px; font-family: 'Oswald'; width: 100%; margin-top: 15px; font-weight: bold; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4); cursor: pointer; }
        .btn-close-modal { background: #333; color: white; border: none; padding: 12px 20px; border-radius: 8px; margin-top: 10px; width: 100%; font-family: 'Oswald'; cursor: pointer; }
    </style>
</head>
<body>

    <div class="main-wrapper">
        <nav class="navbar">
            <div class="brand">BZN12 <span style="color:#F2C317">STUDIO</span></div>
        </nav>

        <section class="preview-section">
            <div id="banner-container">
                <div id="banner" class="lienzo modo-11">
                    <div class="fondo-img"></div>
                    <div id="overlay-dim" class="overlay-dim"></div>
                    <div class="fondo-sombra"></div>

                    <div class="bloque-header-11">
                        <div id="mov-logo-11" class="logo-bzn"><img src="https://i.ibb.co/kgjTkMDX/Gemini-Generated-Image-ky6p34ky6p34ky6p-Photoroom.png" crossorigin="anonymous"></div>
                        <div id="mov-titulo-11" class="titulo-formacion target-titulo-11"><span style="color:#F2C317">11</span> INICIAL</div>
                        <div id="mov-info-match" class="info-partido target-info-match">Local <span style="color:#F2C317">|</span> Visitante</div>
                        <div id="mov-escudos" class="escudos-container">
                            <img id="img-escudo-1" class="escudo-mini" src="" style="display:none;" crossorigin="anonymous">
                            <img id="img-escudo-2" class="escudo-mini" src="" style="display:none;" crossorigin="anonymous">
                        </div>
                    </div>

                    <div id="mov-logo-news" class="logo-noticia"><img src="https://i.ibb.co/kgjTkMDX/Gemini-Generated-Image-ky6p34ky6p34ky6p-Photoroom.png" crossorigin="anonymous"></div>

                    <div id="player-wrapper">
                        <img src="" id="img-glow" class="player-glow" crossorigin="anonymous"> <img src="" id="img-main" class="player-main" crossorigin="anonymous"> </div>
                    <div id="fade-layer" class="player-fade-layer"></div>

                    <div id="mov-lista" class="lista-jugadores target-lista-jugadores"></div>
                    <div id="mov-dt" class="dt-info target-dt-info">
                        <span class="dt-label">DT:</span><span id="dt-nombre-val" class="dt-nombre">Mariano Herr√≥n</span>
                    </div>

                    <div id="mov-bloque-noticia" class="bloque-noticia">
                        <h2 id="txt-titulo" class="target-news-title">TITULAR</h2>
                        <h1 id="txt-frase" class="target-news-phrase">FRASE AMARILLA</h1>
                        <p id="txt-bajada" class="target-news-bajada">Bajada...</p>
                    </div>

                    <div id="mov-legal" class="legal target-legal">BZN12 | Fuente: Prensa Boca</div>
                </div>
            </div>
            
            <button onclick="generarImagen()" class="btn-descarga-flotante">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            </button>
        </section>

        <section class="controls-section">
            <div class="tabs-menu">
                <button class="tab-btn active" onclick="switchTab('tab-posicion', this)">üìê MOVER</button>
                <button class="tab-btn" onclick="switchTab('tab-jugador', this)">üë§ JUGADOR</button>
                <button class="tab-btn" onclick="switchTab('tab-fondos', this)">‚öôÔ∏è FONDOS</button>
                <button class="tab-btn" onclick="switchTab('tab-textos', this)">üìù TEXTOS</button>
                <button class="tab-btn" onclick="switchTab('tab-escudos', this)">üõ°Ô∏è ESCUDOS</button>
                <button class="tab-btn" onclick="switchTab('tab-guardar', this)">üíæ EXTRAS</button>
            </div>

            <div class="panels-container">
                <div id="tab-posicion" class="tab-panel active">
                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <div style="flex:1;">
                            <label style="text-align:center;">‚ÜîÔ∏è X</label>
                            <input type="range" id="move-x" min="-400" max="400" value="0" oninput="aplicarTransformacion()">
                        </div>
                        <div style="flex:1;">
                            <label style="text-align:center;">‚ÜïÔ∏è Y</label>
                            <input type="range" id="move-y" min="-400" max="400" value="0" oninput="aplicarTransformacion()">
                        </div>
                    </div>
                    <label>üîç TAMA√ëO</label>
                    <div class="range-row"><input type="range" id="move-scale" min="0.2" max="3.0" step="0.05" value="1" oninput="aplicarTransformacion()"></div>
                    <hr style="border:0; border-top:1px solid rgba(255,255,255,0.1); margin:15px 0;">
                    <label>SELECCIONAR ELEMENTO</label>
                    <select id="sel-move-target" onchange="cargarPosicionElemento()" class="input-modern" style="margin-bottom:5px;">
                        <option value="player-wrapper">üë§ Jugador (Completo)</option> <optgroup label="Encabezado"><option value="mov-titulo-11">üìù T√≠tulo</option><option value="mov-info-match">üÜö Info Partido</option><option value="mov-escudos">üõ°Ô∏è Escudos</option><option value="mov-logo-11">üîµ Logo</option></optgroup>
                        <optgroup label="Datos"><option value="mov-lista">üìã Lista</option><option value="mov-dt">üëî DT</option><option value="mov-legal">üë£ Footer</option></optgroup>
                        <optgroup label="Noticia"><option value="mov-bloque-noticia">üì∞ Textos</option><option value="mov-logo-news">üîµ Logo Noticia</option></optgroup>
                    </select>
                    <button onclick="resetearElementoActual()" class="btn-small">‚Ü∫ Resetear</button>
                </div>

                <div id="tab-jugador" class="tab-panel">
                    <div class="pill-selector">
                        <label class="pill"><input type="radio" name="accion" value="foto"><span>Solo Foto</span></label>
                        <label class="pill"><input type="radio" name="accion" value="lista"><span>A Lista</span></label>
                        <label class="pill"><input type="radio" name="accion" value="ambos" checked><span>Ambos</span></label>
                    </div>
                    <select id="sel-foto" onchange="ejecutarAccionJugador()" class="input-modern">
                        <option value="">-- Seleccionar --</option>
                        <optgroup label="Arqueros"><option value="https://i.ibb.co/jZ5zjnGR/imagen-19.png">12. Leandro Brey</option><option value="https://i.ibb.co/HfncVTz7/o-7w-I1-RUl-U.png">1. Agustin Marchesin</option><option value="https://i.ibb.co/qLb4xPcS/BWje-I750-Zm-J7.png">13. Javier Garc√≠a</option></optgroup>
                        <optgroup label="Defensores"><option value="https://i.ibb.co/xq0ty38F/imagen-4-png.png">2. Lautaro Di Lollo</option><option value="https://i.ibb.co/wNLBF0fs/imagen-24.png">3. Lautaro Blanco</option><option value="https://i.ibb.co/ZpP89Wgm/imagen-17.png">4. Nicol√°s Figal</option><option value="https://i.ibb.co/99CcJ3B6/kv-Yga-YQE2k-BK.png">6. Rodrigo Battaglia</option><option value="https://i.ibb.co/GQWYdF7r/imagen">17. Lucas Blondel</option><option value="https://i.ibb.co/GQWYdF7r/imagen">23. Marcelo Weingandt</option><option value="https://i.ibb.co/V0yVDPps/imagen-7.png">24. Juan Barinaga</option><option value="https://i.ibb.co/wrwMjQt2/imagen">26. Marco Pellegrino</option><option value="https://i.ibb.co/1GDhj7j0/imagen-2-png.png">32. Ayrton Costa</option><option value="https://i.ibb.co/3yXKKHbd/imagen-2.png">48. Dylan Gorosito</option></optgroup>
                        <optgroup label="Mediocampistas"><option value="https://i.ibb.co/jmD3YL8/imagen-1212.avif">5. Leandro Paredes</option><option value="https://i.ibb.co/60478TJy/imagen-18.png">8. Carlos Palacios</option><option value="https://i.ibb.co/dJwwY7vJ/imagen-23.png">15. Williams Alarc√≥n</option><option value="https://i.ibb.co/tpsvhDxW/imagen-6.png">18. Milton Delgado</option><option value="https://i.ibb.co/SDDMFQnb/imagen-8.png">20. Alan Velasco</option><option value="https://i.ibb.co/C3cVzznH/imagen-5.png">21. Ander Herrera</option><option value="https://i.ibb.co/kVtNgF8S/imagen-1-png.png">22. Kevin Zen√≥n</option><option value="https://i.ibb.co/bMrQ3VHt/imagen-20.avif">25. Santiago Ascacibar</option><option value="https://i.ibb.co/bMrQ3VHt/imagen-20.avif">27. Malcom Braida</option><option value="https://i.ibb.co/Cp8MDvHq/imagen-13.png">30. Tom√°s Belmonte</option><option value="https://i.ibb.co/d0FkYqD8/imagen-3.png">38. Camilo Rey Domenech</option><option value="https://i.ibb.co/bj3Tt9VQ/imagen-12.png">46. Juan Cruz Payal</option><option value="https://i.ibb.co/jvTVWW91/imagen-4.png">53. Joaquin Ruiz</option></optgroup>
                        <optgroup label="Delanteros"><option value="https://i.ibb.co/ZRXJQbHV/imagen-9.png">7. Exequiel Zeballos</option><option value="https://i.ibb.co/ks0n1DR6/imagen-11.png">9. Milton Gim√©nez</option><option value="https://i.ibb.co/HwvQBP7/imagen-15.png">10. Edinson Cavani</option><option value="https://i.ibb.co/tMbHYt1s/imagen-21.png">11. Lucas Janson</option><option value="https://i.ibb.co/CK2Jtr8f/imagen-22.png">16. Miguel Merentiel</option><option value="https://i.ibb.co/ZRXJQbHV/imagen-9.png">29. Angel Romero</option><option value="https://i.ibb.co/ZRXJQbHV/imagen-9.png">33. Brian Aguirre</option></optgroup>
                    </select>
                    <div class="upload-btn-wrapper"><button class="btn-ghost">üìÇ Subir Foto Propia</button><input type="file" id="file-jugador" accept="image/*" onchange="subirJugador()"></div>

                    <div class="glass-card-inner">
                        <label style="color:#FFF; border-bottom:1px solid #444; padding-bottom:5px; margin-bottom:10px;">‚ú® EFECTOS VISUALES</label>
                        <div style="margin-bottom:15px;">
                            <label style="display:flex; align-items:center; gap:10px; cursor:pointer; color:#F2C317;">
                                <input type="checkbox" id="chk-borde" onchange="toggleEfectosJugador()" style="width:18px; height:18px; accent-color:#F2C317;"> 
                                ACTIVAR BORDE DORADO (F√çSICO)
                            </label>
                            <div id="controles-glow" style="display:none; background:rgba(0,0,0,0.3); padding:10px; border-radius:8px; margin-top:5px; border-left:3px solid #F2C317;">
                                <div style="margin-bottom:5px;">
                                    <label style="margin:0; font-size:10px;">INTENSIDAD (Opacidad)</label>
                                    <input type="range" id="glow-opacity" min="0" max="1" step="0.1" value="0.8" oninput="ajustarGlowFisico()">
                                </div>
                                <div>
                                    <label style="margin:0; font-size:10px;">GROSOR (Desenfoque)</label>
                                    <input type="range" id="glow-blur" min="0" max="20" step="1" value="8" oninput="ajustarGlowFisico()">
                                </div>
                            </div>
                        </div>
                        <label style="display:flex; align-items:center; gap:10px; cursor:pointer; color:#90caf9;">
                            <input type="checkbox" id="chk-fade" onchange="toggleEfectosJugador()" style="width:18px; height:18px; accent-color:#90caf9;" checked> 
                            üå´Ô∏è DESVANECER PIES (F√çSICO)
                        </label>
                    </div>
                </div>

                <div id="tab-fondos" class="tab-panel">
                    <label>MODO</label><select id="sel-modo" onchange="cambiarModo()" class="input-modern"><option value="modo-11">üìã 11 INICIAL</option><option value="modo-noticia">üì∞ NOTICIA</option></select>
                    <label>FONDO</label>
                    <select id="sel-fondo" onchange="cambiarFondo()" class="input-modern">
                        <option value="">-- Defecto --</option>
                        <option value="https://i.ibb.co/ZztT2CLn/Gemini-Generated-Image-r4y8efr4y8efr4y8.jpg">La Bombonera</option>
                        <option value="https://i.ibb.co/qMdYY24y/Chat-GPT-Image-26-ene-2026-23-06-53.png">Azul Institucional</option>
                        <option value="https://i.ibb.co/PvRdxvJd/Chat-GPT-Image-27-ene-2026-06-22-54.png">Fondo 3</option>
                        <option value="https://i.ibb.co/ynjHHs87/Generated-Image-January-27-2026-6-42-AM.png">Fondo 4</option>
                        <option value="https://i.ibb.co/Y425Q8CB/Generated-Image-January-27-2026-7-22-AM.png">Fondo 5</option>
                        <option value="https://i.ibb.co/LdCNPH5d/Generated-Image-January-27-2026-7-19-AM.png">Fondo 6</option>
                        <option value="https://i.ibb.co/HfP6phJb/Generated-Image-January-27-2026-7-17-AM.png">Fondo 7</option>
                    </select>
                    <div class="upload-btn-wrapper"><button class="btn-ghost">üìÇ Subir Fondo</button><input type="file" id="file-fondo" accept="image/*" onchange="subirFondo()"></div>
                    <label>FILTROS</label>
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1;"><label style="font-size:9px;">BLUR</label><input type="range" id="range-blur" min="0" max="10" value="0" oninput="ajustarFiltrosFondo()"></div>
                        <div style="flex:1;"><label style="font-size:9px;">DIM</label><input type="range" id="range-dim" min="0" max="0.9" step="0.1" value="0" oninput="ajustarFiltrosFondo()"></div>
                    </div>
                    <label><input type="checkbox" id="chk-byn" onchange="ajustarFiltrosFondo()"> B&N</label>
                </div>

                <div id="tab-textos" class="tab-panel">
                    <div id="panel-11">
                        <label>HEADER</label><input type="text" id="in-header" placeholder="Local - Visitante" class="input-modern" onkeyup="actualizar()">
                        <label>LISTA</label><textarea id="in-lista" rows="6" placeholder="..." class="input-modern" onkeyup="actualizarLista()"></textarea>
                        <label>DT</label><input type="text" id="in-dt" placeholder="DT" class="input-modern" onkeyup="actualizar()">
                    </div>
                    <div id="panel-noticia" class="oculto">
                        <label>TITULAR</label><div style="display:flex; gap:5px;"><input type="text" id="in-titulo" placeholder="TITULAR" class="input-modern" onkeyup="actualizar()"><input type="color" id="col-titulo" value="#ffffff" oninput="cambiarColorNoticia()" style="width:40px;"></div>
                        <label>FRASE</label><div style="display:flex; gap:5px;"><textarea id="in-frase" rows="2" placeholder="FRASE" class="input-modern" onkeyup="actualizar()"></textarea><input type="color" id="col-frase" value="#F2C317" oninput="cambiarColorNoticia()" style="width:40px;"></div>
                        <label>BAJADA</label><div style="display:flex; gap:5px;"><input type="text" id="in-bajada" placeholder="Bajada" class="input-modern" onkeyup="actualizar()"><input type="color" id="col-bajada" value="#dddddd" oninput="cambiarColorNoticia()" style="width:40px;"></div>
                    </div>
                    <hr style="border:0; border-top:1px solid #444; margin:15px 0;">
                    <label>FUENTES</label>
                    <select id="target-element" class="input-modern"><option value="titulo-11">T√≠tulo Principal</option><option value="lista-jugadores">Lista Jugadores</option><option value="news-title">Titular Noticia</option><option value="news-phrase">Frase Noticia</option></select>
                    <select id="sel-fuente" onchange="aplicarEstilos()" class="input-modern"><option value="'Teko', sans-serif">Teko (Oficial)</option><option value="'Anton', sans-serif">Anton</option><option value="'Bebas Neue', cursive">Bebas Neue</option><option value="'Montserrat', sans-serif">Montserrat</option><option value="'Chakra Petch', sans-serif">Chakra Petch</option><option value="'Do Hyeon', sans-serif">Do Hyeon</option><option value="'Exo 2', sans-serif">Exo 2</option><option value="'Fjalla One', sans-serif">Fjalla One</option><option value="'Kanit', sans-serif">Kanit</option><option value="'Oswald', sans-serif">Oswald</option><option value="'Passion One', cursive">Passion One</option><option value="'Righteous', cursive">Righteous</option><option value="'Russo One', sans-serif">Russo One</option><option value="'Saira Extra Condensed', sans-serif">Saira Condensed</option><option value="'Titillium Web', sans-serif">Titillium Web</option><option value="'Playfair Display', serif">Playfair Display</option><option value="'Lobster', cursive">Lobster</option><option value="'Orbitron', sans-serif">Orbitron</option><option value="'Bangers', cursive">Bangers</option></select>
                    <div style="display:flex; gap:10px;"><input type="range" id="rango-tamano" min="10" max="120" value="72" oninput="aplicarEstilos()"><input type="range" id="rango-espaciado" min="-2" max="20" value="0" oninput="aplicarEstilos()"></div>
                    <label>FOOTER</label><input type="text" id="in-legal" placeholder="BZN12 | Fuente..." class="input-modern" onkeyup="actualizarLegal()">
                </div>

                <div id="tab-escudos" class="tab-panel">
                    <label>LOCAL</label>
                    <select id="sel-escudo-1" onchange="cambiarEscudos()" class="input-modern">
                        <option value="">-- Sin Escudo --</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e3/Boca_Juniors_logo18.svg/500px-Boca_Juniors_logo18.svg.png">Boca Juniors</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1e/Escudo_del_Club_Atl%C3%A9tico_River_Plate.svg/1200px-Escudo_del_Club_Atl%C3%A9tico_River_Plate.svg.png">River Plate</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Escudo_de_Racing_Club_%282014%29.svg/1920px-Escudo_de_Racing_Club_%282014%29.svg.png">Racing Club</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/d/db/Escudo_del_Club_Atl%C3%A9tico_Independiente.svg/960px-Escudo_del_Club_Atl%C3%A9tico_Independiente.svg.png">Independiente</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/6/62/Escudo_del_Club_Atl%C3%A9tico_San_Lorenzo_de_Almagro.png">San Lorenzo</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/6/68/Escudo_del_Club_Estudiantes_de_La_Plata.svg/1920px-Escudo_del_Club_Estudiantes_de_La_Plata.svg.png">Estudiantes LP</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Escudo_de_Gimnasia_y_Esgrima_La_Plata.svg/1200px-Escudo_de_Gimnasia_y_Esgrima_La_Plata.svg.png">Gimnasia LP</option>
                        <option value="https://upload.wikimedia.org/wikipedia/en/thumb/c/ce/Rosario_Central_logo.svg/1280px-Rosario_Central_logo.svg.png">Rosario Central</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/c/cd/Escudo_Newells.png">Newell's</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9b/Escudo_Talleres_2015.svg/3840px-Escudo_Talleres_2015.svg.png">Talleres</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/8/85/Escudo_Oficial_del_Club_Atl%C3%A9tico_Belgrano.png/707px-Escudo_Oficial_del_Club_Atl%C3%A9tico_Belgrano.png">Belgrano</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/3/36/Escudo_V%C3%A9lez_Sarsfield.png">V√©lez</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Emblema_oficial_del_Club_Atl%C3%A9tico_Hurac%C3%A1n.svg/1280px-Emblema_oficial_del_Club_Atl%C3%A9tico_Hurac%C3%A1n.svg.png">Hurac√°n</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/2/24/Argentinos_jrs_badge.png">Argentinos Jrs</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/6/68/ESCUDO_DE_LAN%C3%9AS.png">Lan√∫s</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/4/42/Escudo_de_Banfield.png">Banfield</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/1/15/Escudo_defensa_y_justicia.png">Defensa y Justicia</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/8/8a/Escudo_del_Club_Atl%C3%A9tico_Tigre.svg">Tigre</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Escudo_platense.png/250px-Escudo_platense.png">Platense</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b4/Escudo_del_Club_Atletico_Tucuman.svg/1920px-Escudo_del_Club_Atletico_Tucuman.svg.png">Atl√©tico Tucum√°n</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/d/d8/Union_de_Santa_Fe.png">Uni√≥n</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/2/20/Escudo_Asociacion_Atl%C3%A9tica_Estudiantes_de_R%C3%ADo_Cuarto.svg/1280px-Escudo_Asociacion_Atl%C3%A9tica_Estudiantes_de_R%C3%ADo_Cuarto.svg.png">Estudiantes RC</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Bffgfgh.png/221px-Bffgfgh.png">Aldosivi</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Escudo_Instituto_Atletico_Central_Cordoba.png/1280px-Escudo_Instituto_Atletico_Central_Cordoba.png">Instituto</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/3/3d/Barracas_Central.png">Barracas</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/Escudo_del_Club_Atl%C3%A9tico_Sarmiento_de_Jun%C3%ADn.svg/3840px-Escudo_del_Club_Atl%C3%A9tico_Sarmiento_de_Jun%C3%ADn.svg.png">Sarmiento</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/Escudo_del_Club_Central_C%C3%B3rdoba_de_Santiago_del_Estero._%281970s_created_logo%29.svg/3840px-Escudo_del_Club_Central_C%C3%B3rdoba_de_Santiago_del_Estero._%281970s_created_logo%29.svg.png">Central C√≥rdoba</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ab/Escudo_del_Club_Deportivo_Riestra.svg/1920px-Escudo_del_Club_Deportivo_Riestra.svg.png">Riestra</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7f/Escudo_del_Club_Independiente_Rivadavia.svg/3840px-Escudo_del_Club_Independiente_Rivadavia.svg.png">Ind. Rivadavia</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/Escudo_de_Gimnasia_de_Mendoza.png/612px-Escudo_de_Gimnasia_de_Mendoza.png">Gimnasia de Mendoza</option>
                    </select>
                    
                    <label>VISITANTE</label>
                    <select id="sel-escudo-2" onchange="cambiarEscudos()" class="input-modern">
                        <option value="">-- Sin Escudo --</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e3/Boca_Juniors_logo18.svg/500px-Boca_Juniors_logo18.svg.png">Boca Juniors</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1e/Escudo_del_Club_Atl%C3%A9tico_River_Plate.svg/1200px-Escudo_del_Club_Atl%C3%A9tico_River_Plate.svg.png">River Plate</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Escudo_de_Racing_Club_%282014%29.svg/1920px-Escudo_de_Racing_Club_%282014%29.svg.png">Racing Club</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/d/db/Escudo_del_Club_Atl%C3%A9tico_Independiente.svg/960px-Escudo_del_Club_Atl%C3%A9tico_Independiente.svg.png">Independiente</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/6/62/Escudo_del_Club_Atl%C3%A9tico_San_Lorenzo_de_Almagro.png">San Lorenzo</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/6/68/Escudo_del_Club_Estudiantes_de_La_Plata.svg/1920px-Escudo_del_Club_Estudiantes_de_La_Plata.svg.png">Estudiantes LP</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Escudo_de_Gimnasia_y_Esgrima_La_Plata.svg/1200px-Escudo_de_Gimnasia_y_Esgrima_La_Plata.svg.png">Gimnasia LP</option>
                        <option value="https://upload.wikimedia.org/wikipedia/en/thumb/c/ce/Rosario_Central_logo.svg/1280px-Rosario_Central_logo.svg.png">Rosario Central</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/c/cd/Escudo_Newells.png">Newell's</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9b/Escudo_Talleres_2015.svg/3840px-Escudo_Talleres_2015.svg.png">Talleres</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/8/85/Escudo_Oficial_del_Club_Atl%C3%A9tico_Belgrano.png/707px-Escudo_Oficial_del_Club_Atl%C3%A9tico_Belgrano.png">Belgrano</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/3/36/Escudo_V%C3%A9lez_Sarsfield.png">V√©lez</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Emblema_oficial_del_Club_Atl%C3%A9tico_Hurac%C3%A1n.svg/1280px-Emblema_oficial_del_Club_Atl%C3%A9tico_Hurac%C3%A1n.svg.png">Hurac√°n</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/2/24/Argentinos_jrs_badge.png">Argentinos Jrs</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/6/68/ESCUDO_DE_LAN%C3%9AS.png">Lan√∫s</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/4/42/Escudo_de_Banfield.png">Banfield</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/1/15/Escudo_defensa_y_justicia.png">Defensa y Justicia</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/8/8a/Escudo_del_Club_Atl%C3%A9tico_Tigre.svg">Tigre</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Escudo_platense.png/250px-Escudo_platense.png">Platense</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b4/Escudo_del_Club_Atletico_Tucuman.svg/1920px-Escudo_del_Club_Atletico_Tucuman.svg.png">Atl√©tico Tucum√°n</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/d/d8/Union_de_Santa_Fe.png">Uni√≥n</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/2/20/Escudo_Asociacion_Atl%C3%A9tica_Estudiantes_de_R%C3%ADo_Cuarto.svg/1280px-Escudo_Asociacion_Atl%C3%A9tica_Estudiantes_de_R%C3%ADo_Cuarto.svg.png">Estudiantes RC</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Bffgfgh.png/221px-Bffgfgh.png">Aldosivi</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Escudo_Instituto_Atletico_Central_Cordoba.png/1280px-Escudo_Instituto_Atletico_Central_Cordoba.png">Instituto</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/3/3d/Barracas_Central.png">Barracas</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/Escudo_del_Club_Atl%C3%A9tico_Sarmiento_de_Jun%C3%ADn.svg/3840px-Escudo_del_Club_Atl%C3%A9tico_Sarmiento_de_Jun%C3%ADn.svg.png">Sarmiento</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/Escudo_del_Club_Central_C%C3%B3rdoba_de_Santiago_del_Estero._%281970s_created_logo%29.svg/3840px-Escudo_del_Club_Central_C%C3%B3rdoba_de_Santiago_del_Estero._%281970s_created_logo%29.svg.png">Central C√≥rdoba</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ab/Escudo_del_Club_Deportivo_Riestra.svg/1920px-Escudo_del_Club_Deportivo_Riestra.svg.png">Riestra</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7f/Escudo_del_Club_Independiente_Rivadavia.svg/3840px-Escudo_del_Club_Independiente_Rivadavia.svg.png">Ind. Rivadavia</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/Escudo_de_Gimnasia_de_Mendoza.png/612px-Escudo_de_Gimnasia_de_Mendoza.png">Gimnasia de Mendoza</option>
                    </select>

                    <div class="slider-box">
                        <label class="slider-label">Tama√±o Escudos</label>
                        <div class="range-row"><input type="range" id="size-escudos" min="20" max="100" value="45" oninput="ajustarTamanoEscudos()"></div>
                    </div>
                </div>

                <div id="tab-guardar" class="tab-panel">
                    <label>FORMATO</label>
                    <div class="pill-selector">
                        <button class="btn-small" onclick="cambiarFormato('original')">Original</button>
                        <button class="btn-small" onclick="cambiarFormato('story')">Story</button>
                        <button class="btn-small" onclick="cambiarFormato('square')">Post</button>
                    </div>
                    <label>MEMORIA</label>
                    <div style="display:flex; gap:10px;">
                        <button onclick="guardarDatos()" class="btn-ghost">üíæ Guardar Config</button>
                        <button onclick="cargarDatos()" class="btn-ghost">üìÇ Cargar Config</button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div id="modal-descarga" class="modal-overlay">
        <div class="modal-content">
            <h3>¬°IMAGEN LISTA! üì∏</h3>
            <img id="img-generada" src="" alt="Imagen">
            <button onclick="descargarAhora()" class="btn-download-success">üì• DESCARGAR IMAGEN</button>
            <button onclick="cerrarModal()" class="btn-close-modal">CERRAR</button>
        </div>
    </div>

    <script>
        // ELEMENTOS
        const banner = document.getElementById('banner');
        const selModo = document.getElementById('sel-modo');
        const selFondo = document.getElementById('sel-fondo');
        const selFoto = document.getElementById('sel-foto');
        const imgMain = document.getElementById('img-main'); 
        const imgGlow = document.getElementById('img-glow');
        const fadeLayer = document.getElementById('fade-layer');
        const fileFondo = document.getElementById('file-fondo');
        const fileJugador = document.getElementById('file-jugador');

        const selMoveTarget = document.getElementById('sel-move-target');
        const moveX = document.getElementById('move-x');
        const moveY = document.getElementById('move-y');
        const moveScale = document.getElementById('move-scale');

        const chkBorde = document.getElementById('chk-borde');
        const chkFade = document.getElementById('chk-fade');
        // SLIDERS RESTAURADOS PARA LA CAPA F√çSICA
        const sliderGlowOpacity = document.getElementById('glow-opacity');
        const sliderGlowBlur = document.getElementById('glow-blur');
        const panelGlow = document.getElementById('controles-glow');

        const chkByn = document.getElementById('chk-byn');
        const rangeBlur = document.getElementById('range-blur');
        const rangeDim = document.getElementById('range-dim');
        const overlayDim = document.getElementById('overlay-dim');
        const targetElement = document.getElementById('target-element');
        const selFuente = document.getElementById('sel-fuente');
        const rangoTamano = document.getElementById('rango-tamano');
        const rangoEspaciado = document.getElementById('rango-espaciado');

        const selEscudo1 = document.getElementById('sel-escudo-1');
        const selEscudo2 = document.getElementById('sel-escudo-2');
        const imgEscudo1 = document.getElementById('img-escudo-1');
        const imgEscudo2 = document.getElementById('img-escudo-2');
        const sliderSizeEscudos = document.getElementById('size-escudos');
        const p11 = document.getElementById('panel-11');
        const pNoticia = document.getElementById('panel-noticia');

        const inHeader = document.getElementById('in-header');
        const inLista = document.getElementById('in-lista');
        const inDT = document.getElementById('in-dt');
        const inTitulo = document.getElementById('in-titulo');
        const inFrase = document.getElementById('in-frase');
        const inBajada = document.getElementById('in-bajada');
        const inLegal = document.getElementById('in-legal');

        const txtHeader = document.getElementById('mov-info-match'); 
        const listaVis = document.getElementById('mov-lista'); 
        const dtNombreVal = document.getElementById('dt-nombre-val');
        const txtTitulo = document.getElementById('txt-titulo');
        const txtFrase = document.getElementById('txt-frase');
        const txtBajada = document.getElementById('txt-bajada');
        const txtLegal = document.getElementById('mov-legal');

        let downloadBlob = null; 

        function switchTab(tabId, btnElement) {
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            btnElement.classList.add('active');
        }

        const posiciones = {};
        function cargarPosicionElemento() {
            const id = selMoveTarget.value;
            if (!posiciones[id]) posiciones[id] = { x: 0, y: 0, s: 1 };
            moveX.value = posiciones[id].x;
            moveY.value = posiciones[id].y;
            moveScale.value = posiciones[id].s;
        }
        function aplicarTransformacion() {
            const id = selMoveTarget.value;
            const el = document.getElementById(id);
            if (el) {
                const x = moveX.value; const y = moveY.value; const s = moveScale.value;
                posiciones[id] = { x: x, y: y, s: s };
                el.style.transform = `translate(${x}px, ${y}px) scale(${s})`;
            }
        }
        function resetearElementoActual() {
            const id = selMoveTarget.value;
            if(document.getElementById(id)) {
                document.getElementById(id).style.transform = 'none';
                posiciones[id] = { x: 0, y: 0, s: 1 };
                moveX.value = 0; moveY.value = 0; moveScale.value = 1;
            }
        }

        function ajustarFiltrosFondo() {
            const blur = rangeBlur.value + 'px'; const gray = chkByn.checked ? '100%' : '0%';
            document.querySelector('.fondo-img').style.filter = `blur(${blur}) grayscale(${gray})`;
            overlayDim.style.opacity = rangeDim.value;
        }
        function cambiarColorNoticia() {
            txtTitulo.style.color = document.getElementById('col-titulo').value;
            txtFrase.style.color = document.getElementById('col-frase').value;
            txtBajada.style.color = document.getElementById('col-bajada').value;
        }
        
        // --- L√ìGICA F√çSICA PARA EFECTOS ---
        function ajustarGlowFisico() {
            // 1. Actualizamos variables CSS (para consistencia en UI)
            document.documentElement.style.setProperty('--glow-opacity', sliderGlowOpacity.value);
            document.documentElement.style.setProperty('--glow-blur', sliderGlowBlur.value + 'px');
            
            // 2. FUERZA BRUTA: Aplicamos el filtro inline
            // Esto asegura que la librer√≠a html-to-image capture los valores exactos
            // sin depender de la cascada de variables CSS.
            const blurVal = sliderGlowBlur.value + 'px';
            const opacityVal = sliderGlowOpacity.value;
            imgGlow.style.filter = `sepia(100%) hue-rotate(5deg) saturate(1000%) brightness(1.2) blur(${blurVal})`;
            imgGlow.style.opacity = opacityVal;
        }

        function toggleEfectosJugador() {
            // Glow: Mostramos la imagen de atr√°s y el panel de control
            if (chkBorde.checked) { 
                imgGlow.style.display = 'block';
                panelGlow.style.display = 'block';
                ajustarGlowFisico();
            } else { 
                imgGlow.style.display = 'none';
                panelGlow.style.display = 'none';
            }
            
            // Fade: Mostramos el div negro en la base
            if (chkFade.checked) { fadeLayer.style.display = 'block'; } 
            else { fadeLayer.style.display = 'none'; }
        }

        function cambiarModo() { 
            const modo = selModo.value;
            banner.className = 'lienzo ' + modo; 
            if(modo === 'modo-11') {
                p11.classList.remove('oculto'); pNoticia.classList.add('oculto');
            } else {
                p11.classList.add('oculto'); pNoticia.classList.remove('oculto');
            }
        }

        function cambiarFondo() { document.querySelector('.fondo-img').style.backgroundImage = selFondo.value ? `url('${selFondo.value}')` : ''; }
        function subirFondo() { const f = fileFondo.files[0]; if(f) { const r = new FileReader(); r.onload = e => document.querySelector('.fondo-img').style.backgroundImage = `url('${e.target.result}')`; r.readAsDataURL(f); } }
        
        function ejecutarAccionJugador() { 
            if(selFoto.value) { 
                if(document.querySelector('input[name="accion"]:checked').value !== 'lista') { 
                    imgMain.src = selFoto.value; 
                    imgGlow.src = selFoto.value; 
                    document.getElementById('player-wrapper').style.pointerEvents = 'auto';
                    toggleEfectosJugador();
                } 
                if(document.querySelector('input[name="accion"]:checked').value !== 'foto') { 
                    inLista.value += (inLista.value ? "\n" : "") + selFoto.options[selFoto.selectedIndex].text; actualizarLista(); 
                } 
            } 
        }
        function subirJugador() { 
            const f = fileJugador.files[0]; 
            if(f) { 
                const r = new FileReader(); 
                r.onload = e => { 
                    imgMain.src = e.target.result; 
                    imgGlow.src = e.target.result;
                    document.getElementById('player-wrapper').style.pointerEvents = 'auto';
                    toggleEfectosJugador();
                }; 
                r.readAsDataURL(f); 
            } 
        }
        
        function cambiarEscudos() { 
            imgEscudo1.src = selEscudo1.value || ''; imgEscudo1.style.display = selEscudo1.value ? 'block' : 'none'; 
            imgEscudo2.src = selEscudo2.value || ''; imgEscudo2.style.display = selEscudo2.value ? 'block' : 'none'; 
        }
        function ajustarTamanoEscudos() { 
            const val = sliderSizeEscudos.value + 'px';
            imgEscudo1.style.width = val; imgEscudo1.style.height = val; 
            imgEscudo2.style.width = val; imgEscudo2.style.height = val; 
        }

        function actualizarLegal() { if(txtLegal) txtLegal.innerText = inLegal.value || "BZN12 | Fuente: Prensa Boca"; }
        function actualizar() { if(txtHeader) txtHeader.innerHTML = (inHeader.value || "Boca - Rival").replace('-', '<span style="color:#F2C317; margin:0 5px; font-weight:bold;">|</span>'); if(dtNombreVal) dtNombreVal.innerText = inDT.value || "Mariano Herr√≥n"; if(txtTitulo) txtTitulo.innerText = inTitulo.value || "TITULAR"; if(txtFrase) txtFrase.innerText = inFrase.value || "FRASE PRINCIPAL"; if(txtBajada) txtBajada.innerText = inBajada.value || "Bajada..."; }
        function actualizarLista() { const lines = inLista.value.split('\n'); let h = ""; lines.forEach(l => { if(l.trim()) { let p = l.trim().split(/\s+/); let n = (!isNaN(parseFloat(p[0]))) ? p.shift().replace('.','') : "-"; let rest = p.join(' '); let words = rest.split(' '); let ape = words.pop(); h += `<div class="fila-jugador"><div class="dorsal">${n}</div><div class="nombre-completo"><span class="nombre-pila">${words.join(' ')}</span> <span class="apellido">${ape}</span></div></div>`; } }); if(listaVis) listaVis.innerHTML = h; aplicarEstilos(); }
        function aplicarEstilos() {
            const font = selFuente.value; const size = rangoTamano.value + 'px'; const space = rangoEspaciado.value + 'px'; 
            let els = [];
            if(targetElement.value === 'lista-jugadores') { document.querySelectorAll('.nombre-pila, .apellido, .dorsal').forEach(n => n.style.fontFamily = font); document.querySelectorAll('.fila-jugador').forEach(f => f.style.fontSize = size); }
            else {
                if(targetElement.value === 'titulo-11') els = document.querySelectorAll('.target-titulo-11');
                else if(targetElement.value === 'info-match') els = document.querySelectorAll('.target-info-match');
                else if(targetElement.value === 'dt-info') els = document.querySelectorAll('.target-dt-info');
                else if(targetElement.value === 'news-title') els = document.querySelectorAll('.target-news-title');
                else if(targetElement.value === 'news-phrase') els = document.querySelectorAll('.target-news-phrase');
                else if(targetElement.value === 'news-bajada') els = document.querySelectorAll('.target-news-bajada');
                else if(targetElement.value === 'legal-text') els = document.querySelectorAll('.target-legal');
                els.forEach(el => { el.style.fontFamily = font; el.style.fontSize = size; el.style.letterSpacing = space; });
            }
        }

        // === PWA DOWNLOADER MEJORADO ===
        function generarImagen() {
            // Aseguramos que se actualicen las capas f√≠sicas
            toggleEfectosJugador();
            
            // Forzamos actualizaci√≥n de estilos inline si el borde est√° activo
            if(chkBorde.checked) {
                ajustarGlowFisico();
            }
            
            // Peque√±a espera para que el navegador renderice el gradiente negro y el blur
            // antes de tomar la captura. Esto soluciona que salgan invisibles.
            setTimeout(() => {
                htmlToImage.toPng(document.querySelector('.lienzo'), { 
                    cacheBust: true, 
                    pixelRatio: 2, 
                    backgroundColor: null,
                    useCORS: true // Habilitar CORS para filtros en im√°genes externas
                })
                .then(function (dataUrl) {
                    const img = document.getElementById('img-generada');
                    img.src = dataUrl;
                    
                    fetch(dataUrl)
                        .then(res => res.blob())
                        .then(blob => {
                            downloadBlob = blob;
                            document.getElementById('modal-descarga').style.display = 'flex';
                        });
                })
                .catch(function (error) {
                    console.error('Error detallado:', error);
                    alert('Hubo un error al generar la imagen. Intenta desactivar y activar el brillo nuevamente.');
                });
            }, 100); // 100ms de buffer
        }

        function descargarAhora() {
            if (downloadBlob) {
                const url = URL.createObjectURL(downloadBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `BZN_${Date.now()}.png`;
                document.body.appendChild(link);
                link.click();
                setTimeout(() => { document.body.removeChild(link); URL.revokeObjectURL(url); }, 100);
            } else {
                alert("Procesando imagen... intenta de nuevo.");
            }
        }

        function cerrarModal() { document.getElementById('modal-descarga').style.display = 'none'; }
        
        function guardarDatos() { alert("Guardado en local"); }
        function cargarDatos() { alert("Cargado"); }
        function cambiarFormato(t) { banner.className = 'lienzo ' + selModo.value + ' formato-' + t; }
    </script>
</body>
</html>
