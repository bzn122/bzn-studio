<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#001E38">
    
    <!-- PWA Settings -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" type="image/png" href="https://i.ibb.co/kgjTkMDX/Gemini-Generated-Image-ky6p34ky6p34ky6p-Photoroom.png">
    
    <title>BZN12 Studio V129</title>
    
    <!-- Fuentes (Originales + 10 Nuevas) -->
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Barlow+Condensed:wght@600;800&family=Bebas+Neue&family=Chakra+Petch:wght@700&family=Do+Hyeon&family=Exo+2:wght@700&family=Fjalla+One&family=Kanit:wght@700&family=Oswald:wght@500;700&family=Passion+One:wght@700&family=Righteous&family=Roboto+Condensed:wght@300;400;700&family=Russo+One&family=Saira+Extra+Condensed:wght@700&family=Teko:wght@400;600&family=Titillium+Web:wght@700&family=Montserrat:wght@800&family=Playfair+Display:wght@700&family=Lobster&family=Orbitron:wght@700&family=Bangers&family=Archivo+Black&family=Paytone+One&family=Lilita+One&family=Bungee&family=Rowdies:wght@700&family=Luckiest+Guy&family=Permanent+Marker&family=Fredoka+One&family=Josefin+Sans:wght@700&family=Black+Ops+One&display=swap" rel="stylesheet">
    
    <!-- Motor de Renderizado -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>

    <style>
        :root { 
            --azul: #001E38; --oro: #F2C317; 
            --glow-blur: 15px;
            --glow-opacity: 0.7;
            --glow-color: rgba(242, 195, 23, 0.7);
            --mask-fade: none;
        }

        html, body { margin: 0; padding: 0; font-family: 'Roboto Condensed', sans-serif; background: #001222; color: white; min-height: 100vh; overflow-x: hidden; padding-bottom: env(safe-area-inset-bottom); }
        ::-webkit-scrollbar { display: none; }

        /* Navbar */
        .navbar { background: rgba(0, 30, 56, 0.95); backdrop-filter: blur(10px); padding: 15px; text-align: center; border-bottom: 2px solid var(--oro); position: sticky; top: 0; z-index: 1000; font-family: 'Anton'; font-size: 24px; letter-spacing: 1px; user-select: none; }
        .main-wrapper { max-width: 600px; margin: 0 auto; padding-bottom: 40px; }
        
        .preview-section { padding: 20px; display: flex; flex-direction: column; align-items: center; background: radial-gradient(circle, #1a3b5c 0%, #000 100%); }
        #banner-container { transform-origin: top center; box-shadow: 0 20px 50px rgba(0,0,0,0.6); position: relative; }
        
        /* Lienzo */
        .lienzo { width: 400px; height: 500px; position: relative; overflow: hidden; background: #000; border: 1px solid #333; }
        .fondo-img { position: absolute; width: 100%; height: 100%; background-size: cover; background-position: center; z-index: 1; }
        .fondo-sombra { position: absolute; width: 100%; height: 100%; background: radial-gradient(circle at top right, transparent 30%, rgba(0, 0, 0, 0.9) 100%); z-index: 2; }
        .overlay-dim { position: absolute; width: 100%; height: 100%; background: black; opacity: 0; z-index: 1; pointer-events: none; }

        /* JUGADOR - EFECTOS INTACTOS */
        #player-group {
            position: absolute; bottom: 0; right: -50px; width: 480px; height: 85%; z-index: 3;
            transform-origin: bottom center; pointer-events: none;
            display: flex; align-items: flex-end; justify-content: center;
            overflow: visible;
            -webkit-mask-image: var(--mask-fade);
            mask-image: var(--mask-fade);
        }
        .glow-physical {
            position: absolute; width: 80%; height: 80%; object-fit: contain; z-index: 1;
            filter: sepia(100%) hue-rotate(5deg) saturate(1000%) brightness(1.3) blur(var(--glow-blur));
            opacity: var(--glow-opacity);
            transform: scale(1.04); display: none; mix-blend-mode: screen; 
        }
        .main-physical { position: absolute; width: 80%; height: 80%; object-fit: contain; z-index: 2; }

        /* Componentes del Banner */
        .bloque-header-11 { position: absolute; top:0; left:0; width:100%; height:100%; pointer-events: none; transform-origin: top left; }
        .logo-bzn { position: absolute; top: 20px; left: 20px; width: 50px; height: 50px; border-radius: 50%; background: var(--azul); border: 2px solid var(--oro); display: flex; align-items: center; justify-content: center; z-index: 20; }
        .logo-bzn img, .escudo-mini, .logo-noticia img { width: 85%; height: 85%; object-fit: contain; }
        .titulo-formacion { position: absolute; top: 20px; left: 95px; z-index: 10; font-family: 'Teko'; font-weight: 600; font-size: 72px; color: white; letter-spacing: -1px; line-height: 0.8; text-shadow: 2px 2px 4px rgba(0,0,0,0.9); }
        .info-partido { position: absolute; top: 85px; left: 100px; z-index: 10; font-size: 16px; color: #ddd; font-family: 'Teko'; letter-spacing: 0.5px; text-shadow: 1px 1px 3px rgba(0,0,0,0.9); }
        .escudos-container { position: absolute; top: 25px; right: 20px; display: flex; gap: 8px; z-index: 50; transform-origin: right center; }
        .escudo-mini { width: 45px; height: 45px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8)); }
        .lista-jugadores { position: absolute; z-index: 5; top: 120px; left: 20px; display: flex; flex-direction: column; text-shadow: 1px 1px 3px black; font-family: 'Teko'; }
        .dt-info { position: absolute; bottom: 60px; left: 20px; z-index: 5; font-family: 'Teko'; font-size: 24px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 5px; width: 150px; text-shadow: 1px 1px 2px black; }
        .legal { position: absolute; bottom: 10px; width: 100%; text-align: center; font-size: 10px; color: #aaa; z-index: 20; text-shadow: 1px 1px 2px black; }

        /* Estilos Noticia */
        .logo-noticia { position: absolute; top: 30px; left: 30px; width: 50px; height: 50px; border-radius: 50%; background: var(--azul); border: 2px solid var(--oro); display: flex; align-items: center; justify-content: center; z-index: 20; }
        .bloque-noticia { position: absolute; z-index: 10; width: 100%; text-align: center; padding: 0 20px; bottom: 80px; box-sizing: border-box; }
        .modo-noticia h2 { font-family: 'Teko'; font-weight: 600; font-size: 42px; margin: 0; text-shadow: 2px 2px 4px black; }
        .modo-noticia h1 { font-family: 'Teko'; font-weight: 600; font-size: 64px; color: var(--oro); line-height: 0.9; margin: 5px 0 10px 0; text-shadow: 3px 3px 6px black; }
        .modo-noticia p { font-family: 'Teko'; font-weight: 400; font-size: 24px; color: #ddd; margin: 0; text-shadow: 1px 1px 3px black; }
        .modo-noticia .bloque-header-11, .modo-noticia .lista-jugadores, .modo-noticia .dt-info { display: none !important; }
        .modo-noticia #player-group { height: 95%; bottom: -30px; left: 50%; transform: translateX(-50%); right: auto; }
        .modo-11 .logo-noticia, .modo-11 .bloque-noticia { display: none !important; }

        /* Controles UI */
        .controls-section { padding: 15px; }
        .tabs-menu { display: flex; overflow-x: auto; gap: 8px; padding-bottom: 12px; margin-bottom: 10px; scrollbar-width: none; }
        .tab-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: #888; padding: 10px 16px; border-radius: 8px; font-family: 'Oswald'; font-size: 14px; white-space: nowrap; cursor: pointer; }
        .tab-btn.active { background: var(--oro); color: var(--azul); border-color: var(--oro); font-weight: bold; }
        .tab-panel { display: none; background: var(--glass); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        .tab-panel.active { display: block; }
        
        .glass-card-inner { background: rgba(0,0,0,0.2); border-radius: 8px; padding: 15px; border: 1px solid var(--border); margin-top: 15px; }
        label { color: var(--oro); font-weight: bold; font-size: 11px; display: block; margin-bottom: 6px; font-family: 'Oswald'; text-transform: uppercase; }
        input, select, textarea { width: 100%; padding: 12px; background: rgba(0,0,0,0.5); border: 1px solid #444; color: white; border-radius: 8px; font-size: 16px; box-sizing: border-box; margin-bottom: 12px; font-family: 'Roboto Condensed'; }
        
        .pill-selector { display: flex; background: rgba(0,0,0,0.4); padding: 4px; border-radius: 8px; margin-bottom: 15px; }
        .pill { flex: 1; text-align: center; cursor: pointer; }
        .pill input { display: none; }
        .pill span { display: block; padding: 8px; border-radius: 6px; font-size: 12px; color: #aaa; }
        .pill input:checked + span { background: var(--oro); color: #000; font-weight: bold; }
        
        .btn-ghost { border: 1px dashed #666; color: #ccc; background: transparent; width: 100%; padding: 12px; border-radius: 8px; cursor: pointer; text-align: center; font-size: 12px; }
        .upload-btn-wrapper { position: relative; overflow: hidden; margin-bottom: 10px; }
        .upload-btn-wrapper input[type=file] { font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer; }

        #loader { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10001; background: rgba(0,0,0,0.9); padding: 30px; border-radius: 15px; border: 1px solid var(--oro); text-align: center; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; display: none; justify-content: center; align-items: center; }
        .modal-content { background: #1a1a1a; padding: 20px; border-radius: 16px; text-align: center; width: 90%; max-height: 90vh; border: 1px solid var(--oro); overflow-y: auto; }
        .modal-content img { max-width: 100%; border-radius: 8px; margin-bottom: 15px; }
        .btn-download-success { background: #28a745; color: white; border: none; padding: 15px; border-radius: 8px; font-size: 16px; font-family: 'Oswald'; width: 100%; font-weight: bold; cursor: pointer; }
        .oculto { display: none !important; }
    </style>
</head>
<body>

    <div id="loader"><p style="color:var(--oro); font-weight:bold; margin:0;">GENERANDO IMAGEN...</p></div>

    <div class="main-wrapper">
        <nav class="navbar">
            <div class="brand">BZN12 <span style="color:#F2C317">STUDIO</span></div>
        </nav>

        <section class="preview-section">
            <div id="banner-container">
                <div id="banner" class="lienzo modo-11">
                    <div class="fondo-img"></div>
                    <div id="overlay-dim" class="overlay-dim"></div>
                    <div class="fondo-sombra"></div>

                    <div id="mov-header-11" class="bloque-header-11">
                        <div id="mov-logo-11" class="logo-bzn"><img src="https://i.ibb.co/kgjTkMDX/Gemini-Generated-Image-ky6p34ky6p34ky6p-Photoroom.png" crossorigin="anonymous"></div>
                        <div id="mov-titulo-11" class="titulo-formacion target-titulo-11"><span style="color:#F2C317">11</span> INICIAL</div>
                        <div id="mov-info-match" class="info-partido target-info-match">Boca Juniors <span style="color:#F2C317">|</span> Rival</div>
                        <div id="mov-escudos" class="escudos-container">
                            <img id="img-escudo-1" class="escudo-mini" src="" style="display:none;" crossorigin="anonymous">
                            <img id="img-escudo-2" class="escudo-mini" src="" style="display:none;" crossorigin="anonymous">
                        </div>
                    </div>

                    <div id="mov-logo-news" class="logo-noticia"><img src="https://i.ibb.co/kgjTkMDX/Gemini-Generated-Image-ky6p34ky6p34ky6p-Photoroom.png" crossorigin="anonymous"></div>

                    <!-- SISTEMA JUGADOR (NO TOCAR L√ìGICA) -->
                    <div id="player-group">
                        <img src="" id="player-glow-img" class="glow-physical" crossorigin="anonymous">
                        <img src="" id="player-main-img" class="main-physical" crossorigin="anonymous">
                    </div>

                    <div id="mov-lista" class="lista-jugadores target-lista-jugadores"></div>
                    <div id="mov-dt" class="dt-info target-dt-info">
                        <span class="dt-label">DT:</span><span id="dt-nombre-val" class="dt-nombre">Mariano Herr√≥n</span>
                    </div>

                    <!-- Bloque Noticia -->
                    <div id="mov-bloque-noticia" class="bloque-noticia">
                        <h2 id="txt-titulo-noticia" class="target-news-title">TITULAR</h2>
                        <h1 id="txt-frase-noticia" class="target-news-phrase">FRASE AMARILLA</h1>
                        <p id="txt-bajada-noticia" class="target-news-bajada">Bajada informativa...</p>
                    </div>

                    <div id="mov-legal" class="legal target-legal">BZN12 | Fuente: Prensa Boca</div>
                </div>
            </div>
            
            <button onclick="generarImagen()" class="btn-descarga-flotante">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            </button>
        </section>

        <section class="controls-section">
            <div class="tabs-menu">
                <button class="tab-btn active" onclick="switchTab('tab-posicion', this)">üìê MOVER</button>
                <button class="tab-btn" onclick="switchTab('tab-jugador', this)">üë§ JUGADOR</button>
                <button class="tab-btn" onclick="switchTab('tab-fondos', this)">‚öôÔ∏è FONDOS</button>
                <button class="tab-btn" onclick="switchTab('tab-textos', this)">üìù TEXTOS</button>
                <button class="tab-btn" onclick="switchTab('tab-escudos', this)">üõ°Ô∏è ESCUDOS</button>
                <button class="tab-btn" onclick="switchTab('tab-guardar', this)">üíæ EXTRAS</button>
            </div>

            <div class="panels-container">
                <!-- Panel Posicion -->
                <div id="tab-posicion" class="tab-panel active">
                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <div style="flex:1;"><label>‚ÜîÔ∏è X</label><input type="range" id="move-x" min="-400" max="400" value="0" oninput="aplicarTransformacion()"></div>
                        <div style="flex:1;"><label>‚ÜïÔ∏è Y</label><input type="range" id="move-y" min="-400" max="400" value="0" oninput="aplicarTransformacion()"></div>
                    </div>
                    <label>üîç TAMA√ëO</label>
                    <input type="range" id="move-scale" min="0.2" max="3.0" step="0.05" value="1" oninput="aplicarTransformacion()">
                    <hr style="border:0; border-top:1px solid rgba(255,255,255,0.1); margin:15px 0;">
                    <label>ELEGIR CAPA</label>
                    <select id="sel-move-target" onchange="cargarPosicionElemento()" class="input-modern">
                        <option value="player-group">üë§ Jugador + Brillo</option>
                        <optgroup label="Dise√±o"><option value="mov-header-11">Header 11</option><option value="mov-titulo-11">üìù T√≠tulo</option><option value="mov-info-match">üÜö Info Match</option><option value="mov-escudos">üõ°Ô∏è Escudos</option></optgroup>
                        <optgroup label="Info"><option value="mov-lista">üìã Lista</option><option value="mov-dt">üëî DT</option><option value="mov-legal">üë£ Footer</option></optgroup>
                    </select>
                </div>

                <!-- Panel Jugador (RESTAURADO TOTAL) -->
                <div id="tab-jugador" class="tab-panel">
                    <div class="pill-selector">
                        <label class="pill"><input type="radio" name="accion" value="foto"><span>Foto</span></label>
                        <label class="pill"><input type="radio" name="accion" value="lista"><span>Lista</span></label>
                        <label class="pill"><input type="radio" name="accion" value="ambos" checked><span>Ambos</span></label>
                    </div>
                    <select id="sel-foto" onchange="ejecutarAccionJugador()" class="input-modern">
                        <option value="">-- Jugadores Restaurados --</option>
                        <optgroup label="Arqueros">
                            <option value="https://i.ibb.co/jZ5zjnGR/imagen-19.png">12. Leandro Brey</option>
                            <option value="https://i.ibb.co/HfncVTz7/o-7w-I1-RUl-U.png">1. Agustin Marchesin</option>
                            <option value="https://i.ibb.co/qLb4xPcS/BWje-I750-Zm-J7.png">13. Javier Garc√≠a</option>
                        </optgroup>
                        <optgroup label="Defensores">
                            <option value="https://i.ibb.co/xq0ty38F/imagen-4-png.png">2. Lautaro Di Lollo</option>
                            <option value="https://i.ibb.co/wNLBF0fs/imagen-24.png">3. Lautaro Blanco</option>
                            <option value="https://i.ibb.co/ZpP89Wgm/imagen-17.png">4. Nicol√°s Figal</option>
                            <option value="https://i.ibb.co/99CcJ3B6/kv-Yga-YQE2k-BK.png">6. Rodrigo Battaglia</option>
                            <option value="https://i.ibb.co/GQWYdF7r/imagen">17. Lucas Blondel</option>
                            <option value="https://i.ibb.co/V0yVDPps/imagen-7.png">24. Juan Barinaga</option>
                            <option value="https://i.ibb.co/wrwMjQt2/imagen">26. Marco Pellegrino</option>
                            <option value="https://i.ibb.co/1GDhj7j0/imagen-2-png.png">32. Ayrton Costa</option>
                            <option value="https://i.ibb.co/3yXKKHbd/imagen-2.png">48. Dylan Gorosito</option>
                        </optgroup>
                        <optgroup label="Mediocampistas">
                            <option value="https://i.ibb.co/jmD3YL8/imagen-1212.avif">5. Leandro Paredes</option>
                            <option value="https://i.ibb.co/kVtNgF8S/imagen-1-png.png">22. Kevin Zen√≥n</option>
                            <option value="https://i.ibb.co/bMrQ3VHt/imagen-20.avif">25. Santiago Ascacibar</option>
                            <option value="https://i.ibb.co/SDDMFQnb/imagen-8.png">20. Alan Velasco</option>
                            <option value="https://i.ibb.co/Cp8MDvHq/imagen-13.png">30. Tom√°s Belmonte</option>
                        </optgroup>
                        <optgroup label="Delanteros">
                            <option value="https://i.ibb.co/HwvQBP7/imagen-15.png">10. Edinson Cavani</option>
                            <option value="https://i.ibb.co/CK2Jtr8f/imagen-22.png">16. Miguel Merentiel</option>
                            <option value="https://i.ibb.co/ZRXJQbHV/imagen-9.png">7. Exequiel Zeballos</option>
                            <option value="https://i.ibb.co/ks0n1DR6/imagen-11.png">9. Milton Gim√©nez</option>
                            <option value="https://i.ibb.co/ZRXJQbHV/imagen-9.png">33. Brian Aguirre</option>
                            <option value="https://i.ibb.co/ZRXJQbHV/imagen-9.png">29. Angel Romero</option>
                        </optgroup>
                    </select>
                    <div class="upload-btn-wrapper"><div class="btn-ghost">üìÇ Subir PNG Propio</div><input type="file" id="file-jugador" accept="image/*" onchange="subirJugador()"></div>

                    <div class="glass-card-inner">
                        <label style="color:#F2C317;">EFECTOS DE PNG (NO TOCAR L√ìGICA)</label>
                        <label style="display:flex; align-items:center; gap:10px; cursor:pointer; color:#FFF; margin-bottom:10px;">
                            <input type="checkbox" id="chk-borde" onchange="toggleEfectosJugador()" style="width:18px; height:18px; accent-color:#F2C317;"> BRILLO DORADO
                        </label>
                        <div id="panel-glow-ctrl" style="display:none; padding:10px; background:rgba(0,0,0,0.3); border-radius:8px; margin-bottom:15px;">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                                <label style="font-size:10px; margin:0;">PALETA DE COLOR</label>
                                <input type="color" id="glow-color-picker" value="#F2C317" oninput="actualizarEfectos()" style="width:35px; height:35px; border:none; background:none; cursor:pointer;">
                            </div>
                            <div style="display:flex; justify-content:space-between;"><label style="font-size:10px;">GROSOR</label><input type="range" id="glow-blur" min="2" max="50" step="1" value="15" oninput="actualizarEfectos()" style="width:60%;"></div>
                        </div>
                        <label style="display:flex; align-items:center; gap:10px; cursor:pointer; color:#90caf9; margin-bottom:5px;">
                            <input type="checkbox" id="chk-fade" onchange="toggleEfectosJugador()" style="width:18px; height:18px; accent-color:#90caf9;" checked> DESVANECER PIES
                        </label>
                        <div id="panel-fade-ctrl" style="padding:10px; background:rgba(0,0,0,0.3); border-radius:8px;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><label style="font-size:10px;">INICIO</label><input type="range" id="fade-start" min="0" max="100" value="35" oninput="actualizarEfectos()" style="width:60%;"></div>
                            <div style="display:flex; justify-content:space-between;"><label style="font-size:10px;">FINAL</label><input type="range" id="fade-end" min="0" max="100" value="95" oninput="actualizarEfectos()" style="width:60%;"></div>
                        </div>
                    </div>
                </div>

                <!-- Panel Fondos (CON OPCI√ìN DE MODO RESTAURADA) -->
                <div id="tab-fondos" class="tab-panel">
                    <label>MODO VISUAL</label>
                    <select id="sel-modo" onchange="cambiarModo()" class="input-modern">
                        <option value="modo-11">üìã 11 INICIAL</option>
                        <option value="modo-noticia">üì∞ NOTICIA</option>
                    </select>
                    <label>FONDO DEL BANNER (6 FONDOS)</label>
                    <select id="sel-fondo" onchange="cambiarFondo()" class="input-modern">
                        <option value="https://i.ibb.co/ZztT2CLn/Gemini-Generated-Image-r4y8efr4y8efr4y8.jpg">La Bombonera</option>
                        <option value="https://i.ibb.co/qMdYY24y/Chat-GPT-Image-26-ene-2026-23-06-53.png">Azul Institucional</option>
                        <option value="https://i.ibb.co/PvRdxvJd/Chat-GPT-Image-27-ene-2026-06-22-54.png">Dise√±o Estrellas</option>
                        <option value="https://i.ibb.co/ynjHHs87/Generated-Image-January-27-2026-6-42-AM.png">Geom√©trico</option>
                        <option value="https://i.ibb.co/Y425Q8CB/Generated-Image-January-27-2026-7-22-AM.png">Degradado Azul</option>
                        <option value="https://i.ibb.co/LdCNPH5d/Generated-Image-January-27-2026-7-19-AM.png">Templo Bombonera</option>
                    </select>
                    <div class="upload-btn-wrapper"><div class="btn-ghost">üìÇ Subir Fondo Propio</div><input type="file" id="file-fondo" accept="image/*" onchange="subirFondo()"></div>
                </div>

                <!-- Panel Textos -->
                <div id="tab-textos" class="tab-panel">
                    <label>TIPOGRAF√çAS (+10 NUEVAS)</label>
                    <select id="sel-fuente" onchange="aplicarEstilos()" class="input-modern">
                        <option value="'Teko', sans-serif">Teko (Boca)</option>
                        <option value="'Anton', sans-serif">Anton</option>
                        <option value="'Bebas Neue', cursive">Bebas Neue</option>
                        <option value="'Oswald', sans-serif">Oswald</option>
                        <!-- NUEVAS 10 -->
                        <option value="'Archivo Black', sans-serif">Archivo Black</option>
                        <option value="'Lilita One', cursive">Lilita One</option>
                        <option value="'Bungee', cursive">Bungee</option>
                        <option value="'Rowdies', cursive">Rowdies</option>
                        <option value="'Luckiest Guy', cursive">Luckiest Guy</option>
                        <option value="'Fredoka One', cursive">Fredoka One</option>
                        <option value="'Permanent Marker', cursive">Permanent Marker</option>
                        <option value="'Paytone One', sans-serif">Paytone One</option>
                        <option value="'Josefin Sans', sans-serif">Josefin Sans</option>
                        <option value="'Black Ops One', cursive">Black Ops One</option>
                    </select>
                    
                    <div id="panel-inputs-11">
                        <label>CABECERA</label><input type="text" id="in-header" placeholder="Boca Juniors | Rival" class="input-modern" onkeyup="actualizar()">
                        <label>LISTA JUGADORES</label><textarea id="in-lista" rows="3" placeholder="..." class="input-modern" onkeyup="actualizarLista()"></textarea>
                        <label>DT</label><input type="text" id="in-dt" placeholder="Mariano Herr√≥n" class="input-modern" onkeyup="actualizar()">
                    </div>

                    <div id="panel-inputs-noticia" style="display:none;">
                        <label>TITULAR</label><input type="text" id="in-titular-news" placeholder="TITULAR" class="input-modern" onkeyup="actualizar()">
                        <label>FRASE</label><textarea id="in-frase-news" rows="2" placeholder="FRASE" class="input-modern" onkeyup="actualizar()"></textarea>
                        <label>BAJADA</label><input type="text" id="in-bajada-news" placeholder="Bajada informativa" class="input-modern" onkeyup="actualizar()">
                    </div>
                </div>

                <!-- Panel Escudos (RESTAURADO COMPLETO) -->
                <div id="tab-escudos" class="tab-panel">
                    <label>ESCUDO LOCAL</label>
                    <select id="sel-escudo-1" onchange="cambiarEscudos()" class="input-modern">
                        <option value="">-- Sin Escudo --</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e3/Boca_Juniors_logo18.svg/500px-Boca_Juniors_logo18.svg.png">Boca Juniors</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1e/Escudo_del_Club_Atl%C3%A9tico_River_Plate.svg/1200px-Escudo_del_Club_Atl%C3%A9tico_River_Plate.svg.png">River Plate</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Escudo_de_Racing_Club_%282014%29.svg/1920px-Escudo_de_Racing_Club_%282014%29.svg.png">Racing Club</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/d/db/Escudo_del_Club_Atl%C3%A9tico_Independiente.svg/960px-Escudo_del_Club_Atl%C3%A9tico_Independiente.svg.png">Independiente</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/6/62/Escudo_del_Club_Atl%C3%A9tico_San_Lorenzo_de_Almagro.png">San Lorenzo</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/6/68/Escudo_del_Club_Estudiantes_de_La_Plata.svg/1920px-Escudo_del_Club_Estudiantes_de_La_Plata.svg.png">Estudiantes LP</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Escudo_de_Gimnasia_y_Esgrima_La_Plata.svg/1200px-Escudo_de_Gimnasia_y_Esgrima_La_Plata.svg.png">Gimnasia LP</option>
                        <option value="https://upload.wikimedia.org/wikipedia/en/thumb/c/ce/Rosario_Central_logo.svg/1280px-Rosario_Central_logo.svg.png">Rosario Central</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/c/cd/Escudo_Newells.png">Newell's</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9b/Escudo_Talleres_2015.svg/3840px-Escudo_Talleres_2015.svg.png">Talleres</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/8/85/Escudo_Oficial_del_Club_Atl%C3%A9tico_Belgrano.png/707px-Escudo_Oficial_del_Club_Atl%C3%A9tico_Belgrano.png">Belgrano</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/3/36/Escudo_V%C3%A9lez_Sarsfield.png">V√©lez</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Emblema_oficial_del_Club_Atl%C3%A9tico_Hurac%C3%A1n.svg/1280px-Emblema_oficial_del_Club_Atl%C3%A9tico_Hurac%C3%A1n.svg.png">Hurac√°n</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/2/24/Argentinos_jrs_badge.png">Argentinos Jrs</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/6/68/ESCUDO_DE_LAN%C3%9AS.png">Lan√∫s</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/4/42/Escudo_de_Banfield.png">Banfield</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/1/15/Escudo_defensa_y_justicia.png">Defensa y Justicia</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/8/8a/Escudo_del_Club_Atl%C3%A9tico_Tigre.svg">Tigre</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Escudo_platense.png/250px-Escudo_platense.png">Platense</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b4/Escudo_del_Club_Atletico_Tucuman.svg/1920px-Escudo_del_Club_Atletico_Tucuman.svg.png">Atl√©tico Tucum√°n</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/d/d8/Union_de_Santa_Fe.png">Uni√≥n</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/2/20/Escudo_Asociacion_Atl%C3%A9tica_Estudiantes_de_R%C3%ADo_Cuarto.svg/1280px-Escudo_Asociacion_Atl%C3%A9tica_Estudiantes_de_R%C3%ADo_Cuarto.svg.png">Estudiantes RC</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Bffgfgh.png/221px-Bffgfgh.png">Aldosivi</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Escudo_Instituto_Atletico_Central_Cordoba.png/1280px-Escudo_Instituto_Atletico_Central_Cordoba.png">Instituto</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/3/3d/Barracas_Central.png">Barracas</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/Escudo_del_Club_Atl%C3%A9tico_Sarmiento_de_Jun%C3%ADn.svg/3840px-Escudo_del_Club_Atl%C3%A9tico_Sarmiento_de_Jun%C3%ADn.svg.png">Sarmiento</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/Escudo_del_Club_Central_C%C3%B3rdoba_de_Santiago_del_Estero._%281970s_created_logo%29.svg/3840px-Escudo_del_Club_Central_C%C3%B3rdoba_de_Santiago_del_Estero._%281970s_created_logo%29.svg.png">Central C√≥rdoba</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ab/Escudo_del_Club_Deportivo_Riestra.svg/1920px-Escudo_del_Club_Deportivo_Riestra.svg.png">Riestra</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7f/Escudo_del_Club_Independiente_Rivadavia.svg/3840px-Escudo_del_Club_Independiente_Rivadavia.svg.png">Ind. Rivadavia</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/Escudo_de_Gimnasia_de_Mendoza.png/612px-Escudo_de_Gimnasia_de_Mendoza.png">Gimnasia de Mendoza</option>
                    </select>
                    
                    <label>VISITANTE</label>
                    <select id="sel-escudo-2" onchange="cambiarEscudos()" class="input-modern">
                        <option value="">-- Sin Escudo --</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e3/Boca_Juniors_logo18.svg/500px-Boca_Juniors_logo18.svg.png">Boca Juniors</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1e/Escudo_del_Club_Atl%C3%A9tico_River_Plate.svg/1200px-Escudo_del_Club_Atl%C3%A9tico_River_Plate.svg.png">River Plate</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Escudo_de_Racing_Club_%282014%29.svg/1920px-Escudo_de_Racing_Club_%282014%29.svg.png">Racing Club</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/d/db/Escudo_del_Club_Atl%C3%A9tico_Independiente.svg/960px-Escudo_del_Club_Atl%C3%A9tico_Independiente.svg.png">Independiente</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/6/62/Escudo_del_Club_Atl%C3%A9tico_San_Lorenzo_de_Almagro.png">San Lorenzo</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/6/68/Escudo_del_Club_Estudiantes_de_La_Plata.svg/1920px-Escudo_del_Club_Estudiantes_de_La_Plata.svg.png">Estudiantes LP</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Escudo_de_Gimnasia_y_Esgrima_La_Plata.svg/1200px-Escudo_de_Gimnasia_y_Esgrima_La_Plata.svg.png">Gimnasia LP</option>
                        <option value="https://upload.wikimedia.org/wikipedia/en/thumb/c/ce/Rosario_Central_logo.svg/1280px-Rosario_Central_logo.svg.png">Rosario Central</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/c/cd/Escudo_Newells.png">Newell's</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9b/Escudo_Talleres_2015.svg/3840px-Escudo_Talleres_2015.svg.png">Talleres</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/8/85/Escudo_Oficial_del_Club_Atl%C3%A9tico_Belgrano.png/707px-Escudo_Oficial_del_Club_Atl%C3%A9tico_Belgrano.png">Belgrano</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/3/36/Escudo_V%C3%A9lez_Sarsfield.png">V√©lez</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Emblema_oficial_del_Club_Atl%C3%A9tico_Hurac%C3%A1n.svg/1280px-Emblema_oficial_del_Club_Atl%C3%A9tico_Hurac%C3%A1n.svg.png">Hurac√°n</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/2/24/Argentinos_jrs_badge.png">Argentinos Jrs</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/6/68/ESCUDO_DE_LAN%C3%9AS.png">Lan√∫s</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/4/42/Escudo_de_Banfield.png">Banfield</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/1/15/Escudo_defensa_y_justicia.png">Defensa y Justicia</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/8/8a/Escudo_del_Club_Atl%C3%A9tico_Tigre.svg">Tigre</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Escudo_platense.png/250px-Escudo_platense.png">Platense</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b4/Escudo_del_Club_Atletico_Tucuman.svg/1920px-Escudo_del_Club_Atletico_Tucuman.svg.png">Atl√©tico Tucum√°n</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/d/d8/Union_de_Santa_Fe.png">Uni√≥n</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/2/20/Escudo_Asociacion_Atl%C3%A9tica_Estudiantes_de_R%C3%ADo_Cuarto.svg/1280px-Escudo_Asociacion_Atl%C3%A9tica_Estudiantes_de_R%C3%ADo_Cuarto.svg.png">Estudiantes RC</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Bffgfgh.png/221px-Bffgfgh.png">Aldosivi</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Escudo_Instituto_Atletico_Central_Cordoba.png/1280px-Escudo_Instituto_Atletico_Central_Cordoba.png">Instituto</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/3/3d/Barracas_Central.png">Barracas</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/Escudo_del_Club_Atl%C3%A9tico_Sarmiento_de_Jun%C3%ADn.svg/3840px-Escudo_del_Club_Atl%C3%A9tico_Sarmiento_de_Jun%C3%ADn.svg.png">Sarmiento</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/Escudo_del_Club_Central_C%C3%B3rdoba_de_Santiago_del_Estero._%281970s_created_logo%29.svg/3840px-Escudo_del_Club_Central_C%C3%B3rdoba_de_Santiago_del_Estero._%281970s_created_logo%29.svg.png">Central C√≥rdoba</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ab/Escudo_del_Club_Deportivo_Riestra.svg/1920px-Escudo_del_Club_Deportivo_Riestra.svg.png">Riestra</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7f/Escudo_del_Club_Independiente_Rivadavia.svg/3840px-Escudo_del_Club_Independiente_Rivadavia.svg.png">Ind. Rivadavia</option>
                        <option value="https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/Escudo_de_Gimnasia_de_Mendoza.png/612px-Escudo_de_Gimnasia_de_Mendoza.png">Gimnasia de Mendoza</option>
                    </select>
                    <label>TAMA√ëO</label><input type="range" id="size-escudos" min="20" max="100" value="45" oninput="ajustarTamanoEscudos()">
                </div>

                <div id="tab-guardar" class="tab-panel">
                    <button onclick="generarImagen()" class="btn-download-success" style="margin:0;">üì∏ GENERAR IMAGEN FINAL</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal de Descarga -->
    <div id="modal-descarga" class="modal-overlay">
        <div class="modal-content">
            <h3 style="color:var(--oro); font-family:'Oswald';">DISE√ëO GENERADO üì∏</h3>
            <img id="img-generada" src="" alt="Resultado">
            <button onclick="descargarAhora()" class="btn-download-success">üì• GUARDAR EN GALER√çA</button>
            <button onclick="cerrarModal()" class="btn-ghost" style="margin-top:10px; width:100%;">CERRAR</button>
        </div>
    </div>

    <script>
        const banner = document.getElementById('banner');
        const playerGroup = document.getElementById('player-group');
        const imgMain = document.getElementById('player-main-img');
        const imgGlow = document.getElementById('player-glow-img');
        const selModo = document.getElementById('sel-modo');
        const selFondo = document.getElementById('sel-fondo');
        const selFoto = document.getElementById('sel-foto');
        const loader = document.getElementById('loader');

        const chkBorde = document.getElementById('chk-borde');
        const chkFade = document.getElementById('chk-fade');
        const sliderBlur = document.getElementById('glow-blur');
        const pickerColor = document.getElementById('glow-color-picker');
        const panelGlow = document.getElementById('panel-glow-ctrl');
        const panelFade = document.getElementById('panel-fade-ctrl');
        const sliderFadeStart = document.getElementById('fade-start');
        const sliderFadeEnd = document.getElementById('fade-end');

        let downloadBlob = null;
        const posiciones = {};

        function switchTab(tabId, btn) {
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            btn.classList.add('active');
        }

        function cargarPosicionElemento() {
            const id = document.getElementById('sel-move-target').value;
            if (!posiciones[id]) posiciones[id] = { x: 0, y: 0, s: 1 };
            document.getElementById('move-x').value = posiciones[id].x;
            document.getElementById('move-y').value = posiciones[id].y;
            document.getElementById('move-scale').value = posiciones[id].s;
        }

        function aplicarTransformacion() {
            const id = document.getElementById('sel-move-target').value;
            const el = document.getElementById(id);
            if (!el) return;
            const x = document.getElementById('move-x').value;
            const y = document.getElementById('move-y').value;
            const s = document.getElementById('move-scale').value;
            posiciones[id] = { x, y, s };
            el.style.transform = `translate(${x}px, ${y}px) scale(${s})`;
        }

        function resetearElementoActual() {
            const id = document.getElementById('sel-move-target').value;
            const el = document.getElementById(id);
            if(el) { el.style.transform = 'none'; posiciones[id] = { x: 0, y: 0, s: 1 }; cargarPosicionElemento(); }
        }

        // --- EFECTOS (L√≥gica Intacta) ---
        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `${r}, ${g}, ${b}`;
        }

        function actualizarEfectos() {
            if (chkBorde.checked) {
                const colorHex = pickerColor.value;
                document.documentElement.style.setProperty('--glow-blur', sliderBlur.value + 'px');
                document.documentElement.style.setProperty('--glow-opacity', '0.7');
                imgGlow.style.filter = `blur(${sliderBlur.value}px) brightness(1.5) drop-shadow(0 0 5px ${colorHex})`;
            }
            if (chkFade.checked) {
                const start = sliderFadeStart.value;
                const end = sliderFadeEnd.value;
                const fadeStyle = `linear-gradient(to bottom, rgba(0,0,0,1) ${start}%, rgba(0,0,0,0.3) ${(parseInt(start)+parseInt(end))/2}%, rgba(0,0,0,0) ${end}%)`;
                document.documentElement.style.setProperty('--mask-fade', fadeStyle);
            } else {
                document.documentElement.style.setProperty('--mask-fade', 'none');
            }
        }

        function toggleEfectosJugador() {
            imgGlow.style.display = chkBorde.checked ? 'block' : 'none';
            panelGlow.style.display = chkBorde.checked ? 'block' : 'none';
            panelFade.style.display = chkFade.checked ? 'block' : 'none';
            actualizarEfectos();
        }

        function ejecutarAccionJugador() {
            if(!selFoto.value) return;
            const url = selFoto.value;
            const mode = document.querySelector('input[name="accion"]:checked').value;
            if(mode !== 'lista') { imgMain.src = url; imgGlow.src = url; toggleEfectosJugador(); }
            if(mode !== 'foto') {
                const nombre = selFoto.options[selFoto.selectedIndex].text;
                document.getElementById('in-lista').value += (document.getElementById('in-lista').value ? "\n" : "") + nombre;
                actualizarLista();
            }
        }

        function subirJugador() {
            const f = document.getElementById('file-jugador').files[0];
            if(!f) return;
            const r = new FileReader();
            r.onload = e => { imgMain.src = e.target.result; imgGlow.src = e.target.result; toggleEfectosJugador(); };
            r.readAsDataURL(f);
        }

        function cambiarModo() { 
            const modo = selModo.value;
            banner.className = 'lienzo ' + modo;
            document.getElementById('panel-inputs-11').style.display = modo === 'modo-11' ? 'block' : 'none';
            document.getElementById('panel-inputs-noticia').style.display = modo === 'modo-noticia' ? 'block' : 'none';
            actualizarEfectos();
        }

        function cambiarFondo() { document.querySelector('.fondo-img').style.backgroundImage = `url('${selFondo.value}')`; }
        function subirFondo() { const f = document.getElementById('file-fondo').files[0]; if(f) { const r = new FileReader(); r.onload=e=>document.querySelector('.fondo-img').style.backgroundImage=`url('${e.target.result}')`; r.readAsDataURL(f); } }
        
        function cambiarEscudos() { 
            const e1 = document.getElementById('img-escudo-1');
            const e2 = document.getElementById('img-escudo-2');
            e1.src = document.getElementById('sel-escudo-1').value;
            e2.src = document.getElementById('sel-escudo-2').value;
            e1.style.display = e1.src && e1.src.length > 5 ? 'block' : 'none';
            e2.style.display = e2.src && e2.src.length > 5 ? 'block' : 'none';
        }

        function ajustarTamanoEscudos() { 
            const v = document.getElementById('size-escudos').value + 'px'; 
            document.getElementById('img-escudo-1').style.width = v; document.getElementById('img-escudo-1').style.height = v;
            document.getElementById('img-escudo-2').style.width = v; document.getElementById('img-escudo-2').style.height = v;
        }

        function actualizarLista() { 
            const lines = document.getElementById('in-lista').value.split('\n'); 
            let h = ''; 
            lines.forEach(l => { if(l.trim()) h += `<div class="fila-jugador"><span class="apellido">${l}</span></div>`; }); 
            document.getElementById('mov-lista').innerHTML = h; 
        }

        function actualizar() { 
            document.getElementById('mov-info-match').innerText = document.getElementById('in-header').value || 'BZN12 | Rival'; 
            document.getElementById('dt-nombre-val').innerText = document.getElementById('in-dt').value || 'Mariano Herr√≥n'; 
            
            // Noticia
            document.getElementById('txt-titulo-noticia').innerText = document.getElementById('in-titular-news').value || 'TITULAR';
            document.getElementById('txt-frase-noticia').innerText = document.getElementById('in-frase-news').value || 'FRASE AMARILLA';
            document.getElementById('txt-bajada-noticia').innerText = document.getElementById('in-bajada-news').value || 'Bajada informativa...';
        }

        function aplicarEstilos() { 
            const font = document.getElementById('sel-fuente').value;
            document.querySelectorAll('.target-titulo-11, .target-lista-jugadores, .dt-info, .info-partido, .target-news-title, .target-news-phrase, .target-news-bajada').forEach(el => el.style.fontFamily = font); 
        }

        function generarImagen() {
            loader.style.display = 'block';
            
            // Fix Fuente en Exportaci√≥n: Forzamos el renderizado de la fuente seleccionada
            aplicarEstilos();
            const bannerNode = document.getElementById('banner');
            
            htmlToImage.toPng(bannerNode, {
                cacheBust: true,
                pixelRatio: 2,
                backgroundColor: null,
                fontEmbedCSS: true
            })
            .then(dataUrl => {
                const img = document.getElementById('img-generada');
                img.src = dataUrl;
                fetch(dataUrl).then(res => res.blob()).then(blob => {
                    downloadBlob = blob;
                    loader.style.display = 'none';
                    document.getElementById('modal-descarga').style.display = 'flex';
                });
            })
            .catch(err => {
                loader.style.display = 'none';
                console.error("Error al generar imagen:", err);
            });
        }

        function descargarAhora() {
            if(!downloadBlob) return;
            const url = URL.createObjectURL(downloadBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `BZN12_${Date.now()}.png`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function cerrarModal() { document.getElementById('modal-descarga').style.display = 'none'; }
        
        window.onload = () => {
            actualizarEfectos();
            cambiarEscudos();
            aplicarEstilos();
        };
    </script>
</body>
</html>
